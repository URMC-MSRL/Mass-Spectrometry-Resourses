function registerMerchandisingData(b){try{if(!!b.detail.analyticsVisitorID){Offers.sessionData.sessionId=b.detail.analyticsVisitorID;Offers.postEventsForFirstVisit()}}catch(a){console.log(a)}}if(document.addEventListener){document.addEventListener("registerMerchandisingData",registerMerchandisingData)}else{if(document.attachEvent){document.attachEvent("registerMerchandisingData",registerMerchandisingData)}}function OffersInit(){return{version:"2022.1.5",sessionData:{sessionId:null,ips:[],referrerDomain:"",searchTerm:"NULL",isNewVisitor:false,cid:"NULL",iCount:0,marketingPageId:"",marketingRegion:"",pagePath:"",userType:"",channel:""},debugOffers:false,FIRSTVISIT:"firstVisit",postEventsCallback:[],setAudienceDone:false,firstVisit:false,ipsAll:{},ipsPreloaded:[],ipsDefaultOffers:[],ipsPostloaded:[],ipsIncluded:[],ipsExcluded:[],loadFinished:false,payload:false,waitForPayload:false,executed:false,channel:"",searchTerm:"NULL",scode:null,loadOfferURL:"/event/offer/load",postEventURL:"/event/offer/postevent",aemOfferUiURL:"/event/offer/ui",startSessionURL:"/event/offer/startsession",setAudienceURL:"/event/offer/setaudience",initComplete:false,initStart:new Date().getTime(),initEnd:0,initDuration:0,request:{},response:{},interactReportParams:{},postEvents:[],ipsPayloadNotRequired:["tf-headerfooter-hb","tf-scms-digitalMerch","tf-headerfooter-lb","tf-account-container-1"],promotionsDiv:"tf-cq-pc",getCookie:function(f){var e=f+"=",a=document.cookie,d=a.indexOf(e),b=null,c;if(d!==-1){c=a.indexOf("; ",d);if(c===-1){c=a.length}b=a.slice(d+e.length,c);b=unescape(b)}return b},getUrlParameter:function(b){var e=decodeURIComponent(Offers.location.search().substring(1)),d=e.split("&"),f,c,a=false;for(c=0;c<d.length;c++){f=d[c].split("=");if(f[0]===b){a=f[1]===undefined?true:f[1];break}}return a},prepareInteractOfferRequest:function(g,d){var c,b=this.getQueryParam("CID"),f=[],a,e=0;c=$.extend({},this.sessionData);c.sessionId=this.sessionData.sessionId;c.isNewVisitor=this.getIsNewVisitor("s_days_since");if(b.length!==0){c.cid=b}c.channel=this.channel||(this.channel=this.getChannel());c.userType=this.getUserType();c.marketingRegion=this.getMarketingRegion();c.marketingPageId=this.getMarketingPageId();for(e=0;e<d.length;e++){f.push(d[e])}if(!f.length){a=this.getIps();for(e=0;e<a.length;e++){f.push(e)}}c.ips=f;c.pagePath=this.processPagePath(Offers.location.pathname(),Offers.location.search());if(g){if(g.hasOwnProperty("skus")){g.pdpSkus=g.skus;delete g.skus}if(g.hasOwnProperty("cartTotal")){if(g.cartTotal==="undefined"||g.cartTotal===undefined||g.cartTotal===null){g.cartTotal=""}else{g.cartTotal=g.cartTotal.replace(/[$,]+/g,"")}}if(g.hasOwnProperty("cartSkus")){g.cartSkus=this.createCartSkusObj(g.cartSkus)}if(g.hasOwnProperty("searchTerm")){this.searchTerm=g.searchTerm}$.extend(c,g)}console.log("offers.js - Offers Request Payload: "+JSON.stringify(c));return c},getIps:function(d){var b=".dynamic-offer[id] , .dynamic-offer:not([id])",a="",h={},g="",f="",c,e=0;if(!!d&&!!d.include){for(;e<d.include.length;e++){g+="#"+d.include[e]+", ";f+="."+d.include[e]+", ";this.ipsIncluded.push(d.include[e])}a=g+f.substring(0,f.length-2)}b=!!a?a:b;$(b).each(function(){var k=$(this).attr("class"),j=$(this).attr("id");if(!!j){h[j]="id"}else{if(!!k){k=k.split(" ");if(k.indexOf("hide")==-1){for(e=0;e<k.length;e++){c=k[e];if(c.indexOf("tf-")>-1){h[c]="class"}}}}}});if(!!d&&!!d.exclude){e=0;for(;e<d.exclude.length;e++){if(!Offers.includes(this.ipsExcluded,d.exclude[e])){this.ipsExcluded.push(d.exclude[e])}delete h[d.exclude[e]]}}this.ipsAll=h;return h},includes:function(d,b){var c=d.length;for(var a=0;a<c;a++){if(d[a]===b){return true}}return false},checkIfExists:function(d,c,b){for(var a in d){if(d[a][c]===b){return true}}return false},requestPostloadedOffers:function(b,a){console.log("requestPostloadedOffers()",b,a);this.request=this.prepareInteractOfferRequest(b,a);if(this.getCookie("cq-authoring-mode")!=null){Offers.showDefaultContent()}else{this.invokeOfferSnippetAjax(this.request)}return true},loadOffers:function(c,a){console.log("loadOffers() called. ",c);if(Offers.loadFinished){return}Offers.channel=this.getChannel();Offers.ipsAll=this.getIps(a);var b=this.payloadRequired();if(!b&&c){console.log("does not need payload.");return"does not need payload"}if(b&&!c){console.log("need payload.");return"need payload"}this.validatePreloadOffers();this.setPostEventsForPreload();this.response.sessionId=this.cleanSessionId(this.request.sessionId);if(!!this.ipsPostloaded&&this.ipsPostloaded.length>0){console.log("Preload incomplete :: start postload or ips:",this.ipsPostloaded);this.requestPostloadedOffers(c,this.ipsPostloaded)}Offers.loadFinished=true;if(Offers.setAudienceDone){Offers.executePostEventCallbacksForFirstVisit()}},executePostEventCallbacksForFirstVisit:function(){var a=0,b;for(;a<Offers.postEventsCallback.length;a++){b=Offers.postEventsCallback[a];Offers.postPageViewEvent(b[0],b[1],b[2])}Offers.postEventsCallback=[]},validatePreloadOffers:function(){Offers.ipsPreloaded=this.getPreloadedIpsWithInteractOffers();Offers.ipsDefaultOffers=this.getPreloadedIpsWithDefaultOffers();Offers.ipsPostloaded=this.getPostloadedIps()},setPostEventsForPreload:function(){var e,d,b,g,a,f,c;if(!this.isPreloadOffersAvailable()){console.log("No offer placement map available from preload. No postevents sent for preload.");return false}f=window.preloadOffers.response.offerPlacementMap;e=this.ipsPreloaded;console.log("Sent post events for the preloaded offers:",e);for(d=0;d<e.length;d++){b=e[d];console.log("post ip",b);g=f[b];if(!!g&&!!g.offerHTML){a=this.getOfferTypeFromDivId(b);c=document.querySelector("."+b+" , #"+b);if(c.getAttribute("preloaded")){this.sendContactEvent(g,a);this.addClickEvent(g,a,b,d)}else{this.offerInjectedEvent(g,a,b,d)}}else{console.log("Offer Html invalid. Contact event is not triggered for divId: "+b)}}return true},offerInjectedEvent:function(d,b,a,c){if(document.addEventListener){document.addEventListener(a,function(e){console.log("addEvent for : "+a);Offers.sendContactEvent(d,b);Offers.addClickEvent(d,b,a,c)})}else{if(document.attachEvent){document.documentElement.attachEvent("onpropertychange",function(e){if(e.propertyName==a){console.log("attachEvent for :"+a);Offers.sendContactEvent(d,b);Offers.addClickEvent(d,b,a,c);document.documentElement.detachEvent("onpropertychange",arguments.callee)}})}}},getPreloadedInteractionPoints:function(){var b=[],a;for(a=0;a<Offers.ipsPreloaded.length;a++){try{b.push(window.preloadOffers.response.offerPlacementMap[Offers.ipsPreloaded[a]].interactPoint)}catch(c){console.error("Exception in getting Interaction Point for div id:",Offers.ipsPreloaded[a])}}return b},sendContactEvent:function(b,a){interactReportParams=this.prepareInteractReportParams(a,b);if(Offers.firstVisit){Offers.postEventsCallback.push([b,"contact",this.interactReportParams])}else{this.postPageViewEvent(b,"contact",interactReportParams)}},addClickEvent:function(d,b,a,c){divType=this.ipsAll[a];divToLoadOfferObj=$((divType==="id"?"#":".")+a);this.ctaAction(b,d,divToLoadOfferObj,c)},addToCartEvent:function(l){var k=k||{};var b=l?l:{};var d=b.ctaObj;var h=b.interactObject;var g=b.offerObj;var e=h.dpoSku;var a="SOM";var c=Offers.getPageType();var f={add:"Add to cart",adding:"Adding...",added:"Added to cart"};var j={event:"event25",data:{eVar66:a+"|AddToCart|0|"+e+c+"|"+b.sku,eVar67:a+"|AddToCart|0|"+e+c+"|"+b.sku,prop62:k.pageType,eVar62:k.pageType}};console.log("Offer Js - Add to cart Product: ",e);Offers.addToCartAnalytics(a,c,e);if(typeof miniCart!=="undefined"&&miniCart.addProductsToCart){$(d[1]).length>0?$(d[1]).text(f.adding):$(d[1]);d.attr("style","color:gray !important; cursor: default;").addClass("disabled");if(!g.find(".offer-cta").hasClass("dm-btn-text")){g.find(".offer-cta").css("background-color","gray")}miniCart.addProductsToCart([{sku:e,qty:1}],j);$(d[1]).length>0?$(d[1]).text(f.added):$(d[1]);console.log("Offer Js - Added to cart - Product: ",e)}else{console.log("minicart object not found on the page.")}},getPageType:function(){if(window.location.href.indexOf("/search/results")>-1){return"searchpage"}return"searchpage"},checkForAddToCart:function(c,b){var a=c.text()?c.text().toLowerCase().trim():"";if(a.includes("add to cart")){c.attr("addToCart","true");if(c&&c.length>1){$(c[0]).parent().removeClass("entireClickable")}}},checkAndInvokeAddToCart:function(c,b,a){if(c[0]&&c[0].getAttribute("addToCart")=="true"){if(!(c.hasClass("disabled"))){Offers.addToCartEvent({ctaObj:c,interactObject:b,offerObj:a})}return true}return false},addToCartAnalytics:function(b,f,h){console.log("Offer Js - Add To Cart Analytics Product: ",h);var c="addToCart",a="Search Optimization";var g="1",k="1",d="1";var l={addMethod:a,catalogNumber:h,quantity:d,title:"",uom:"",price:"",designId:h,recommendationLocation:f,recommendationPosition:g,recommendationType:b,recommendationNewFormat:b+"|"+f+"|"+c+"|"+g+"|"+k+"|"+h};console.log("Offer JS - Sending Add To Cart Analytics for Product: ",h);try{document.dispatchEvent(new CustomEvent("cartAdd",{detail:{products:[l]}}))}catch(j){console.log("Error while sending Analytics for Add To Cart Product Recommendation New Format");console.error(j)}},isPreloadOffersAvailable:function(){return !!window.preloadOffers&&!!window.preloadOffers.response&&!!window.preloadOffers.response.offerPlacementMap},getPreloadedIpsWithInteractOffers:function(){var e=[],a=this.getIps(),d,b,c;if(this.isPreloadOffersAvailable()){c=window.preloadOffers.response.offerPlacementMap;for(d in a){b=document.querySelector("#"+d+" , ."+d);if(!!b&&b.getAttribute("preloaded")=="true"&&c.hasOwnProperty(d)){e.push(d)}}}console.log("getPreloadedIpsWithInteractOffers():",e);return e},getPreloadedIpsWithDefaultOffers:function(){var c=[],b=this.getIps(),d,a;if(this.isPreloadOffersAvailable()){for(d in b){a=(b[d]=="id")?"#":".";if(!!$(a+d)&&$(a+d).attr("preloaded")=="false"){c.push(d)}}}return c},getPostloadedIps:function(){var d=this.ipsDefaultOffers,c=this.ipsPreloaded,a=[],b;for(b in Offers.ipsAll){if(!Offers.includes(d,b)&&!Offers.includes(c,b)&&!Offers.includes(Offers.ipsExcluded,b)){a.push(b)}}console.log("Postloaded ips: "+a);return a},validatePayload:function(d,a){var c=false,b;if(a==="search"){b=d;if(b===null||typeof b==="undefined"){console.log("Empty payload to request dynamic offer for search result page.")}else{if(!b.hasOwnProperty("searchTerm")){console.log("Missing parameter searchTerm in the payload.")}else{if(!b.hasOwnProperty("focusArea")){console.log("Missing parameter focusArea in the payload.")}else{c=true;if(typeof b.searchTerm==="undefined"||b.searchTerm===null||b.searchTerm.trim().length===0){console.warn("WARN: empty search term.");c=true}if(typeof b.focusArea==="undefined"||b.focusArea===null||b.focusArea.trim().length===0){console.warn("WARN: Empty focus area.");c=true}}}}}return c},loadSearchOffers:function(a){this.validatePayload(a,"search");if(this.debugOffers){console.log("Loading search offer with payload: "+JSON.stringify(a))}this.start(a)},loadPdpOffers:function(a){this.start(a,{exclude:["tf-cart-overlay-1"]})},loadCartOffers:function(a){this.start(a)},loadCartOverlay:function(a){console.log("loadCartOverlay()",a);this.requestPostloadedOffers(a,["tf-cart-overlay-1"])},setSessionId:function(){var b=this.getCookie("s_vi")||this.FIRSTVISIT,a=window.preloadOffers;if(!navigator.cookieEnabled){b="cookies-disabled"}if(!!a&&!!a.succeed&&!!a.response&&!!a.response.sessionId){Offers.sessionData.sessionId=a.response.sessionId}else{Offers.sessionData.sessionId=b}if(b!=this.FIRSTVISIT&&b!="cookies-disabled"&&!Offers.setAudienceDone){Offers.postEventsForFirstVisit()}},start:function(d,a){console.log("Offers.start()",JSON.stringify(d),JSON.stringify(a));var c=this.payloadRequired();if(c&&!d){return}try{if(this.meetMinimalJQueryVersion()){$(function(){try{Offers.createEventListener(d,a);Offers.preloadResponseValidation(d,a);Offers.executePreloadScripts()}catch(e){console.log("offers.js unexpected error: "+e)}})}else{console.log("JQuery version not met. Load default offers.");Offers.showDefaultContent();return false}}catch(b){console.log("Cannot load offers. Load default offers. Error:",b);Offers.showDefaultContent();return false}return true},executePreloadScripts:function(){var c=window.preloadOffers,f,e,b,d;if(!c||!c.scriptNode||c.scriptNode.length<=0){return}for(b=0;b<c.scriptNode.length;b++){try{e=c.scriptNode[b];d=e.parentElement;f=document.createElement("script");f.type="text/javascript";f.text=e.text;d.insertBefore(f,e);d.removeChild(e)}catch(a){console.log("offers.js - node script could not execute")}}},handlerEvent:function(){var b=Offers.payloadTemp,a=Offers.excludedOrIncludedIpsTemp;if(document.removeEventListener){document.removeEventListener("preloadOffers",Offers.handlerEvent)}else{if(document.detachEvent){document.detachEvent("preloadOffers",Offers.handlerEvent)}}Offers.preloadResponseValidation(b,a)},createEventListener:function(d,b){Offers.payloadTemp=d;Offers.excludedOrIncludedIpsTemp=b;var a=window.addEventListener||document.attachEvent;try{a("preloadOffers",function(e){console.log("Event:",e);Offers.preloadResponseValidation(d,b)})}catch(c){console.error("Cannot create event listener. Error:",c)}},preloadResponseValidation:function(c,a){Offers.setSessionId();var b=window.preloadOffers;if(!b||!b.version){console.log("Preload incomplete :: start postload or ips:",Offers.ipsPostloaded);Offers.ipsAll=this.getIps(a);Offers.validatePreloadOffers();Offers.requestPostloadedOffers(c,Offers.ipsPostloaded);return}if(!!b.hasOwnProperty("succeed")){if(!!b.response){Offers.firstVisit=b.response.firstVisit;Offers.loadOffers(c,a)}else{Offers.ipsAll=this.getIps(a);Offers.validatePreloadOffers();console.log("Preload incomplete :: start postload or ips:",Offers.ipsPostloaded);Offers.requestPostloadedOffers(c,Offers.ipsPostloaded)}}},postEventsForFirstVisit:function(){try{if(!window.preloadOffers.response){console.log("postEventsForFirstVisit() - preloadOffers.response is not available.");return false}}catch(a){console.log("preloadOffers object not initalized");return false}if(!window.preloadOffers.response.firstVisit||Offers.setAudienceDone){console.log("postEventsForFirstVisit() - not the first visit anymore.");return false}Offers.validatePreloadOffers();var b={uuid:window.preloadOffers.response.sessionId,svi:Offers.getCookie("s_vi"),channel:Offers.channel,preloadedInteractionPoints:Offers.getPreloadedInteractionPoints()};if(b.preloadedInteractionPoints.length>0){Offers.setAudienceDone=true;$.ajax({url:Offers.setAudienceURL,type:"POST",data:JSON.stringify(b),contentType:"application/json",success:function(f,c,g){try{var d=JSON.parse(g.responseText);if(d.statusCode==1||d.statusCode==0){Offers.executePostEventCallbacksForFirstVisit();return true}else{console.error("postEventsForFirstVisit() - set audience status code error:",d.statusCode);return false}}catch(e){console.error("postEventsForFirstVisit() - error in sending page view event:",e);return false}},error:function(e,c,d){console.error("postEventsForFirstVisit() - error in set audience ajax call to back end service.",d)}})}},createCartSkusObj:function(b){var f={},c,e,d,a;if(b){for(c=0;c<b.length;c++){e=b[c].sku;d=b[c].quantity;if(f.hasOwnProperty(e)){a=f[e];f[e]=a+d}else{f[e]=d}}}return f},invokeOfferSnippetAjax:function(a){window.performance&&window.performance.mark&&window.performance.mark("offers.js:loadBegin");$.ajax({url:this.loadOfferURL,type:"POST",data:JSON.stringify(a),contentType:"application/json; charset=utf-8",dataType:"json",timeout:5000,success:function(d,e,c){if(c&&c.hasOwnProperty("responseText")){var b=JSON.parse(c.responseText);Offers.response=$.extend(Offers.response,b);Offers.setInteractValues(b);if(Offers.debugOffers){console.log("offers.js - Starting loading offers for session:::: "+b.hasOwnProperty("statusCode")?"status code : "+b.statusCode:"no status code")}if(b.hasOwnProperty("statusCode")&&b.statusCode==200){Offers.loadOfferSnippetHTML(b.offerPlacementMap)}else{if(Offers.debugOffers){console.log("offers.js - Status Code: Not defined or not 200. Showing default contents.")}Offers.showDefaultContent()}}else{if(Offers.debugOffers){console.log("offers.js - No jqXHR.hasOwnProperty - responseText")}Offers.showDefaultContent()}window.performance&&window.performance.mark&&window.performance.mark("offers.js:loadEnd")},error:function(c,b){if(Offers.debugOffers){console.log("offers.js - Load call did not complete correctly")}Offers.showDefaultContent();window.performance&&window.performance.mark&&window.performance.mark("offers.js:loadEnd")}})},setInteractValues:function(c){var e=(c.hasOwnProperty("sessionId")?c.sessionId:""),d=(c.hasOwnProperty("s_vi_low")?c.s_vi_low:""),a=(c.hasOwnProperty("s_vi_high")?c.s_vi_high:""),b=(c.hasOwnProperty("timeStamp")?c.timeStamp:new Date());if(typeof Interact!=="undefined"){Interact.sessionId=e;Interact.s_vi_low=d;Interact.s_vi_high=a;Interact.timeStamp=b;Interact.localTimeStamp=new Date();this.cid=this.getCookie("s_cmp_tc");if(!!Interact.startSessionComplete&&typeof Interact.startSessionComplete.resolve==="function"){Interact.startSessionComplete.resolve()}if(this.debugOffers){console.log("offers.js - Interact sessionId = "+Interact.sessionId);console.log("offers.js - Interact s_vi_low = "+Interact.s_vi_low);console.log("offers.js - Interact s_vi_high = "+Interact.s_vi_high);console.log("offers.js - Interact timeStamp = "+Interact.timeStamp);console.log("offers.js - Interact startSessionComplete  as resolved")}}else{if(this.debugOffers){console.log("offers.js - Interact object not defined!!!")}}if(!!digitalData&&!!digitalData.addChildObjectAttribute){digitalData.addChildObjectAttribute("merchandising","sessionId",e);digitalData.addChildObjectAttribute("merchandising","s_vi_high",a);digitalData.addChildObjectAttribute("merchandising","s_vi_low",d)}},showDefaultContent:function(e){var d,b,a,c;if(e){b=$("#"+e).length>0?"#":".";d=$(b+e).children(".loading-wheel-block");c=d.children(".loading-wheel");if(this.debugOffers){console.log("offers.js - Showing default content for: "+b+e)}}else{if(this.debugOffers){console.log("offers.js - Showing default content")}d=$(".loading-wheel-block");c=$(".loading-wheel")}a=d.children(".defaultOffer");d.css("padding-top","0px");a.css("visibility","visible");c.remove();if(this.channel==="fs"){a.find(".parsys.content-par-main").removeAttr("style")}},loadOfferSnippetHTML:function(g){var f=this.ipsAll,d=0,b,h,e,a=0,c;if(!f){return}if(!g){for(c in this.ipsPostloaded){this.showDefaultContent(this.ipsPostloaded[c])}return}for(b in f){h=f[b];e=g[b];if(b===this.promotionsDiv){this.loadPromotionOffers(b,e,d,h);a++}else{if(e&&e.snippetPath){this.loadIndividualOffer(b,e,d,h);a++}else{this.showDefaultContent(b)}}d+=1}if(this.debugOffers){console.log("offers.js - loadOfferSnippetHTML: Total Offer to execute = "+a)}},jcrContentFormat:function(b){if(this.channel==="fs"&&!!b){var a="/jcr:content/content-par-main.html";b=b.split(".html")[0]+a}return b},getOfferTypeFromDivId:function(b){var a={};a.isOverlayOffer=(b.indexOf("-overlay-")>-1);a.isCartOffer=(b.indexOf("-cart-")>-1);a.isCQOffer=(b.indexOf("-cq-")>-1);a.isPdpOffer=(b.indexOf("-pdp-")>-1);a.isSearchOffer=(b.indexOf("-search-")>-1);a.isHeaderOffer=(b.indexOf("-hb")>-1);a.isFooterOffer=(b.indexOf("-lb")>-1);a.isScmsOffer=(b.indexOf("-scms")>-1);a.isAccountOffer=(b.indexOf("-account")>-1);return a},loadIndividualOffer:function(h,f,k,c){var d=f,g=d.hasOwnProperty("snippetPath")?d.snippetPath:"",j=h,l=$((c==="id"?"#":".")+j),e=false,a=this.getOfferTypeFromDivId(h),b=d.hasOwnProperty("offerHTML")?d.offerHTML:"";if(g.indexOf(this.aemOfferUiURL)>-1){e=true}else{g=this.jcrContentFormat(g)}if(this.debugOffers){console.log("offers.js - snippetPath for divId : "+j+"= "+g)}if(!!b&&this.setOfferHTML(d,l,b,a,k)){if(this.debugOffers){console.log("offers.js - currentOfferHTML set on divId : "+j+", Ajax call skipped for currentSnippetPath : "+g)}return}$.ajax({url:g,success:function(p){var m=false,o=Offers.prepareInteractReportParams(a,d);if((e&&!!p)||Offers.isValidHtmlOfferStructure(p)){l.html(p);Offers.checkForCartoverlayOffer(p,l);l.removeClass("hide");try{m=window.preloadOffers.response.firstVisit}catch(n){console.error("preload was not successful")}if(m&&!Offers.setAudienceDone){Offers.postEventsCallback.push([d,"contact",o])}else{Offers.postPageViewEvent(d,"contact",o)}Offers.ctaAction(a,d,l,k)}else{Offers.showDefaultContent(h)}},error:function(){Offers.showDefaultContent(h)}})},setOfferHTML:function(c,f,g,a,d){if(!Offers.isValidHtmlOfferStructure(g)){Offers.showDefaultContent(f);return false}g=Offers.updatePDPOfferHTML(g,f);f.html(g);Offers.checkForCartoverlayOffer(g,f);f.removeClass("hide");var b=false;interactReportParams=Offers.prepareInteractReportParams(a,c);try{b=window.preloadOffers.response.firstVisit}catch(e){console.error("preload was not successful")}if(b&&!Offers.setAudienceDone){Offers.postEventsCallback.push([c,"contact",interactReportParams])}else{Offers.postPageViewEvent(c,"contact",interactReportParams)}Offers.ctaAction(a,c,f,d);return true},loadPromotionOffers:function(h,a,y,e){var l=[],b=h,p=$((e==="id"?"#":".")+b),g=this.getOfferTypeFromDivId(h);var c=[];for(i=0;i<a.length;i++){var w=a[i];if(!!w.offerAvailable&&!!w.offerHTML&&w.offerHTML.length>0){l.push(w);if(!this.checkIfExists(c,"promoCode",w.promoCode)){var m=w.promoCode.replace(/\s/g,"").toLowerCase();var f={promoCode:w.promoCode,promoValue:m};c.push(f)}}else{if(this.debugOffers){console.log("offers.js - Invalid promotional Offer : "+b+"= "+w)}}}if(l.length===0){console.log("offers.js - No Valid promotional Offers");return}var d='<div class="promo-filter-center"><span class="h3">Filter By:&nbsp;</span><button class="btn btn-primary promo-filter-btn active" data-promoCode="all"> All</button> $$OFFERS_FILTERS$$</div>';var o='<div class="divider section"><hr role="presentation"></div>';$("<link/>",{rel:"stylesheet",type:"text/css",href:"/dm-offers/promotions.css"}).appendTo("head");var r="";for(i=0;i<c.length;i++){var u=c[i];r+='<button class="btn btn-primary promo-filter-btn" data-promoCode="'+u.promoValue+'" >'+u.promoCode+"</button>"}d=d.replace("$$OFFERS_FILTERS$$",r);var n='<div class="promo-offers">';var j='<div class="span3 $$OFFERTYPE$$">';var v="</div>";var q="</div>";var k='<div class="container">';k+=d;k+=o;k+=n;for(i=0;i<l.length;i++){var w=l[i];var m=w.promoCode.replace(/\s/g,"").toLowerCase();var t=this.replaceAllDotsWithArg(w.treatmentCode,"");k+=j.replace("$$OFFERTYPE$$","filterDiv "+m+"\" id='"+t+"'");k+=w.offerHTML;k+=v}k+=q;$(p).html(k);this.initPromotionFilterActions();for(i=0;i<l.length;i++){var w=l[i];var x=$("#"+this.replaceAllDotsWithArg(w.treatmentCode,""));this.initPromotionPostEvents(g,w,x)}},initPromotionFilterActions:function(){$(document).on("click",".promo-filter-btn",function(){$(".promo-filter-btn").removeClass("active");$(this).addClass("active");var b=$(this).attr("data-promocode");var a=".filterDiv.".concat(b);var c=".filterDiv";if(b==="all"){$(c).show();$(a).hide()}else{$(c).hide();$(a).show()}})},initPromotionPostEvents:function(a,b,d){var c=Offers.prepareInteractReportParams(a,b);Offers.postPageViewEvent(b,"contact",c);Offers.ctaAction(a,b,d)},prepareInteractReportParams:function(a,c){var e={},d;e.userType=Offers.getUserType();if(c.hasOwnProperty("interactPoint")){interactPointArray=c.interactPoint.split("|");e.placementCode=interactPointArray[interactPointArray.length-1]}if(a.isHeaderOffer){e.pagePath=Offers.location.pathname();d=c;e.offerUrl=d.offerUrl}else{if(a.isFooterOffer||a.isCQOffer||a.isScmsOffer||a.isAccountOffer){e.pagePath=Offers.location.pathname()}else{if(a.isSearchOffer){if(!!Offers.request&&!!Offers.request.searchTerm){e.searchTerm=Offers.request.searchTerm}else{try{e.searchTerm=$("#autoCorrectedKeyword").length>0?common.param.autoCorrectedKeyword:common.param.keyword}catch(b){console.log("common parameters not defined")}}}else{if(a.isPdpOffer){e.pagePath=Offers.location.pathname();if(!!Offers.request&&!!Offers.request.pdpSkus){e.productSku=Offers.request.pdpSkus}else{if(!!window.pdpSettings&&!!window.pdpSettings.sku){e.productSku=[window.pdpSettings.sku]}}}}}}if(a.isCartOffer){e.cartSkus=Offers.request.cartSkus;e.cartTotal=Offers.request.cartTotal;e.totalCartQty=Offers.request.totalQty}Offers.interactReportParams=e;return e},ctaAction:function(a,e,d,c){if(a.isOverlayOffer){this.initCartOverlayCtaActions(e)}else{if(a.isCartOffer){this.initCartCtaActions(e,d,c)}else{if(a.isPdpOffer){this.initPdpCtaActions(e,d)}else{if(a.isCQOffer||a.isScmsOffer){this.initCqCtaActions(e,d)}else{if(a.isSearchOffer){this.initSearchCtaActions(e,d)}else{try{this.HeaderFooterCtaAction[this.channel](e,d)}catch(b){console.log("no function for this channel: "+this.channel)}}}}}}},isValidHtmlOfferStructure:function(c){var e=false,d,a,b;if(typeof c!=="undefined"&&c.length>0){if(c.indexOf("aem-offer-container")!==-1||c.indexOf("<head")===-1){e=true}else{d=new DOMParser().parseFromString(c,"text/html");a=$(d).find("head");if(typeof a!=="undefined"&&a.length>0){b=a.html();if(typeof b!=="undefined"&&b.trim().length===0){e=true}}}}return e},sendAnalytics:function(d,c,b,a){if("tf"===this.channel){this.tfAnalytics(d,c,b,a)}},tfAnalytics:function(g,f,d,c){if(typeof s!=="undefined"){var b="",h,a,e="";s.linkTrackVars="prop66,eVar66,prop67,eVar67";switch(g){case"pdp":h=location.pathname.replace(/^(\/[a-z]+)(\/[a-z]+)(\/[a-z]+)(\/)/g,"");a=s.pageURL;e="PDP Offers";b="View PDP ("+h+"): UpSell Promotion- 0";this.pdpAnalytics(d.offerIcid);break;case"search":e="Search Offers";b="View Search Page: Promotion- 0";this.searchAnalytics(d.offerIcid);break;case"cart":b="View Cart: UpSell Promotion- "+c;e="Cart Offers";break;case"overlay":b="View cart overlay: UpSell Promotion - 0";e="Cart Offers";this.pdpAnalytics(d.offerIcid);break}s.prop66=b;s.eVar66=b;s.prop67=b;s.eVar67=b;s.tl(f,"o",e,null,null);if(g==="pdp"){s.pageURL=a}}},pdpAnalytics:function(b){if(typeof b!=="undefined"&&b.length>0){s.linkTrackVars+=",eVar21";s.eVar21=b;s.pageURL=this.addParameter(s.pageURL,"icid",b);var a=new Date();a.setTime(a.getTime());this.setCookie("s_ev21_tc","",a)}},searchAnalytics:function(a){var d="AEM|Search Results",c,b,e="";if(this.isValidValue(search.main.params.autoCorrectedKeyword)){e=search.main.params.autoCorrectedKeyword}else{e=this.searchTerm.toLowerCase()}s.linkTrackVars+=",prop14,eVar14";s.prop14=d;s.eVar14=d;if(this.isValidValue(e)){s.linkTrackVars+=",prop44,eVar44";c="AEM|"+e;s.prop44=c;s.eVar44=c;if(this.isValidValue(a)){s.linkTrackVars+=",prop34,eVar34";b="AEM|PROMO-CODE|"+a+"|"+e;s.prop34=b;s.eVar34=b}}},initPdpCtaActions:function(e,k){var a=k.find("button").attr("class"),h=k.find("button."+a).first(),d=h.data("target")?h.data("target"):"",c=d.substring(1),b=c.replace(/[^A-Za-z0-9\-\_]+/g,""),f,g,j=this.validInteractOfferUrl(e);if(document.getElementById(c)){document.getElementById(c).id=b}d="#"+b;h.attr("data-target",d);h.attr("data-url",j);h.unbind("click");h.attr("data-toggle","hide");h.click(function(){f=Offers.prepareInteractReportParams({isPdpOffer:true},e);Offers.postPageViewEvent(e,"accept",f);g=$(d).find("div.modal-body");g.load(j+" .MainParsys",function(m,l,n){if(l==="success"){h.attr("data-toggle","modal");$(d).modal("show");if(this.debugOffers){console.log("Load offer url success: "+j)}}if(l==="error"){if(this.debugOffers){console.log("Error "+n.status+": "+n.statusText)}}});Offers.sendAnalytics("pdp",this,e)})},initCqCtaActions:function(d,b){var c=b.find("a"),e,a;if(c.length===0){console.log("CQ offer contains no <a> tag. Find <img> to add <a>.");b.find("img").each(function(){var f=$(this);if(!f.parent().is("a")){f.wrap("<a></a>")}});c=b.find("a")}e="";a=this.getUrlParameter("emid");c.each(function(){e=Offers.validInteractOfferUrl(d,$(this).attr("href"));if(!!a){e=this.addParameter(e,"emid",a)}$(this).attr("href",e)});c.click(function(){var f=Offers.prepareInteractReportParams({isCQOffer:true},d);Offers.postPageViewEvent(d,"accept",f)})},initSearchCtaActions:function(e,c){var d=c.find("a"),a=d.attr("href"),b,f=this.validInteractOfferUrl(e,a);this.checkForAddToCart(d,e);d.attr("href",f);d.click(function(){if(Offers.checkAndInvokeAddToCart(d,e,c)){return false}b=Offers.prepareInteractReportParams({isSearchOffer:true},e);Offers.postPageViewEvent(e,"accept",b);Offers.sendAnalytics("search",this,e)})},HeaderFooterCtaAction:{tf:function(d,g){var f=g.attr("id"),b=".promo-bar-snippet",c,j,e,h,a={isHeaderOffer:true};if(f.indexOf("hb")===-1){b=".landscape-banner-snippet";a.isHeaderOffer=false;a.isFooterOffer=true}c=g.find(b);if(c&&c.length<1){c=g.find(".entireClickable > a")}j=c.attr("href");e=Offers.validInteractOfferUrl(d,j);c.attr("href",e);c.click(function(){var k=Offers.prepareInteractReportParams(a,d);Offers.postPageViewEvent(d,"accept",k)});if(b===".landscape-banner-snippet"){g.find("button.landscape-banner-button").each(function(){$(this).click(function(){var k=Offers.prepareInteractReportParams(a,d);Offers.postPageViewEvent(d,"reject",k)})})}},fs:function(e,b){var d=b.find("a"),c=d.attr("href"),a=Offers.validInteractOfferUrl(e,c);d.attr("href",a);d.click(function(){Offers.postPageViewEvent(e,"accept",{})})}},initCartOverlayCtaActions:function(c){var a=$(".overlay-modal-body"),e=$(".chevroncont"),b=$(".chevroncont").find("button"),d=this.validInteractOfferUrl(c);a.load(d+" .MainParsys");e.click(function(){var f=Offers.prepareInteractReportParams({isCartOffer:true},c);$(".chevronoverlay").toggleClass("down");if(b.text()==="Learn more"){b.text("Show less");a.show();Offers.sendAnalytics("overlay",this,c);Offers.postPageViewEvent(c,"accept",f)}else{b.text("Learn more");a.hide();Offers.postPageViewEvent(c,"ignore",f)}})},initCartCtaActions:function(d,b,a){var c=b.find("button").attr("class"),g=b.find("button."+c),f,e=this.validInteractOfferUrl(d);g.attr("data-url",e);g.unbind("click");g.attr("data-toggle","hide");f=g.data("target");g.click(function(){var j=$(f).find("div.modal-body"),h;j.load(e+" .MainParsys",function(){g.attr("data-toggle","modal");$(f).modal("show")});h=Offers.prepareInteractReportParams({isCartOffer:true},d);Offers.postPageViewEvent(d,"accept",h);Offers.sendAnalytics("cart",this,d,a)})},validInteractOfferUrl:function(d,c){var a=d.offerUrl,b=d.offerIcid;a=(!!a&&a!=="."&&a!=="_")?a:c;if(!a){return""}if(!!b&&b!=="."&&b!=="_"){b=b.replace(/\s+/g,"");a=this.addParameter(a,"icid",b)}return a},isValidValue:function(a){return(typeof a!=="undefined"&&a.length>0)},buildDebugDetails:function(h,e,c,b,f,d,a){var g="";g="<div id='offerSnippetDebug'><div class='alert text-left' style='font-size: 10px; overflow-wrap: break-word;'>";g+="SessionId: "+h+"<br>";g+="Interaction Point: "+e+"<br>";g+="OfferUrl: "+c+"<br>";g+="TreatmentCode: "+b+"<br>";g+="Landing Url: "+f+"<br>";g+="ICID: "+d+"<br>";g+="Snippet Path: "+a+"<br>";g+="</div></div>";console.log("debug="+g);return g},postPageViewEvent:function(h,f,g){var c,e,d,a=h.treatmentCode;if(!a){console.log("Offer treatment code is undefined.");return false}c={};if(!!window.preloadOffers.response){c.businessSegment=window.preloadOffers.response.businessSegment||""}else{c.businessSegment=Offers.response.businessSegment}if(Offers.firstVisit&&!!window.preloadOffers.response){c.sessionId=window.preloadOffers.response.sessionId}else{c.sessionId=Offers.sessionData.sessionId}c.treatmentCode=a;c.eventType=f;c.channel=this.channel;c.action="pageview";c.isFirstVisit=!!window.preloadOffers&&!!window.preloadOffers.response&&window.preloadOffers.response.firstVisit;c.offerCode=h.offerCode||[];c.interactPoint=h.interactPoint||"";if(this.internal){c.internal=true}try{$.extend(c,g)}catch(b){console.error(b);for(e in g){d=g[e];c[e]=d}}console.log("interactReportParams:",JSON.stringify(g));console.log("posteventRequest:",JSON.stringify(c));Offers.sendPostEvent(c);return true},sendPostEvent:function(a){var b={};b.request=a;$.ajax({url:this.postEventURL,type:"POST",data:JSON.stringify(a),contentType:"application/json; charset=utf-8",dataType:"json",error:function(){console.error("Post event failed - param:",JSON.stringify(a))}}).done(function(c){b.response=c}).always(function(){Offers.postEvents.push(b)})},postCartEventToInteractServlet:function(b,a){this.sendPostEvent(this.getPostEventPayload(b,"postcart",a))},postPurchaseEventToInteractServlet:function(b,a){this.sendPostEvent(this.getPostEventPayload(b,"postpurchase",undefined,a))},postFormSubmitEventToInteractServlet:function(b,a){this.sendPostEvent(this.getPostEventPayload(b,"formsubmit",a))},postDownloadEventToInteractServlet:function(b,a){this.sendPostEvent(this.getPostEventPayload(b,"postdownload",a))},getPostEventPayload:function(d,c,b,a){return{sessionId:d,channel:Offers.channel,internal:Offers.internal,pagePath:b,action:c,eventType:a}},getIsNewVisitor:function(b){var a=Offers.getDaysSinceLastVisit(b+"_new");return a==="First Visit"||a==="Less than 1 day"},getDaysSinceLastVisit:function(q){var g=q+"_s",c=new Date(),o=new Date(),f,n=c.getTime(),p=24*60*60*1000,h=30*60*1000,e=3*365*p,m="Cookies Not Supported",b="First Visit",a="More than 30 days",k="More than 7 days",t="Less than 7 days",l="Less than 1 day",u,r,j;c.setTime(n+e);o.setTime(n+h);f=Offers.getCookie(q);if(f===null||f.length===0){Offers.setCookie(q,n,c);Offers.setCookie(g,b,o)}else{r=n-f;if(r>h){if(r>30*p){Offers.setCookie(q,n,c);Offers.setCookie(g,a,o)}else{if(r<=30*p&&r>7*p){Offers.setCookie(q,n,c);Offers.setCookie(g,k,o)}else{if(r<=7*p&&r>p){Offers.setCookie(q,n,c);Offers.setCookie(g,t,o)}else{if(r<=p){Offers.setCookie(q,n,c);Offers.setCookie(g,l,o)}}}}}else{Offers.setCookie(q,n,c);u=Offers.getCookie(g);Offers.setCookie(g,u,o)}}j=Offers.getCookie(g);if(j===null){return""}else{if(!j||j.length===0){return m}else{return j}}},setCookie:function(b,c,a){document.cookie=b+"="+c+";path=/;expires="+a.toGMTString()+"; domain="+location.hostname.substring(location.hostname.lastIndexOf(".",location.hostname.lastIndexOf(".")-1))},getMarketingRegion:function(){var a="NA",b;if(!!window.ltCountryInfo){b=this.getCookie("CK_ISO_CODE");b=!!b?b:"us";if(window.ltCountryInfo[b]&&window.ltCountryInfo[b].regionMapping){a=window.ltCountryInfo[b].regionMapping}}else{if(!!window.interactClientContext){a=interactClientContext.marketingRegion}}return a},getMarketingPageId:function(){var a="HP";if(typeof interactClientContext!=="undefined"&&typeof interactClientContext.marketingPageId!=="undefined"&&interactClientContext.marketingPageId!==""){a=interactClientContext.marketingPageId}return a},getUserType:function(){var c="anonymous",a,b;if(this.channel==="fs"){a=this.getCookie("estore");b=this.getCookie("punchout");if(b&&a){a=a+"|"+b}c=a}else{if(this.channel==="tf"){c=this.getCookie("CK_DISPLAY_TYPE")}}if(!c){c="anonymous"}return c},getQueryParam:function(f){var b,c,d,e,a=Offers.location.href().slice(Offers.location.href().indexOf("?")+1).split("&");for(b=0;b<a.length;b++){e=a[b].split("=");c=e[0];d=e[1];if(c.toUpperCase()===f.toUpperCase()){return d}}return""},addParameter:function(a,c,b){a=this.removeParameter(a,c);if(!!a){if(a.indexOf("?")===-1){a=a+"?"}if(a.indexOf("?")!==a.length-1){a=a+"&"}a=a+c+"="+b}return a},removeParameter:function(b,h){var g=!!b?b.split("?"):"",a,f,e,d,c;if(g.length>=2){a=g.shift();f=g.join("?");e=encodeURIComponent(h)+"=";d=f.split(/[&;]/g);for(c=d.length;c-->0;){if(d[c].lastIndexOf(e,0)!==-1){d.splice(c,1)}}b=a+"?"+d.join("&")}return b},payloadRequired:function(){if(!!window.location&&window.location.pathname.match(".*store/cart.*")!=null){return true}if(!!window.location&&window.location.pathname.match(".*catalog/product.*")!=null){return true}var b=[],c=false,a;for(key in this.ipsAll){b.push(key)}for(a=0;a<b.length;a++){if(b[a].indexOf(this.channel+"-cq")>-1){break}if(!Offers.includes(Offers.ipsPayloadNotRequired,b[a])){c=true;break}}return c},checkForCartoverlayOffer:function(g,d){if(typeof d.selector!=="undefined"&&d.selector.indexOf("tf-cart-overlay")!==-1){var a=$(g),c=a.text().split("\n"),b=Offers.getCartoverlayOfferText(c),e='<div class="overlay-modal-wrapper"><div class="overlay-modal-body" style="display: none;"></div></div>',f='<div class="dynamic-offer promotion promo-module" id="tf-cart-overlay-1"> <p id="cart-text"> '+b+'</p> <span class="chevroncont"> <div class="overlayicon chevronoverlay"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 20 5" id="chevron-up" class="overlay-cta"> <path fill="#1e8ae7" fill-rule="evenodd" d="M7.879 10.778L.1 3 2.22.879 10 8.657 17.778.879 19.9 3 10 12.9l-2.121-2.122z" /></svg> </div> <button id="overlaybutton" type="button" data-toggle="hide" data-target="#Test-Title-for-Modal-Modal" class="btn-link" id="overlay-button">Learn more</button></span></div>';$("#tf-cart-overlay-1").replaceWith(f);if($(".overlay-modal-wrapper").length>0){$(".overlay-modal-wrapper").replaceWith(e)}else{$("#tf-cart-overlay-1").after(e)}}},getCartoverlayOfferText:function(c){var b="",a;for(a=0;a<c.length;a++){if(!!c[a]&&c[a].trim().length>3){b=c[a];break}}return b},updatePDPOfferHTML:function(d,c){try{if(typeof c.selector!=="undefined"&&c.selector.indexOf("tf-pdp-1")!==-1){var a=new DOMParser().parseFromString(d,"text/html");anchor=a.querySelector("#pdp-image");if(this.validateOldPDPHTML(anchor)){wrapper=document.createElement("div");wrapper.appendChild(anchor.nextElementSibling);wrapper.appendChild(anchor.nextElementSibling);wrapper.appendChild(anchor.nextElementSibling);anchor.parentElement.appendChild(document.createElement("div"));anchor.parentElement.appendChild(wrapper);return anchor.parentElement.parentElement.outerHTML}}}catch(b){console.log(b)}return d},validateOldPDPHTML:function(a){return a.nodeName==="DIV"&&a.nextElementSibling.nodeName==="P"&&a.nextElementSibling.nextElementSibling.nodeName==="DIV"&&a.nextElementSibling.nextElementSibling.nextElementSibling.nodeName==="P"},meetMinimalJQueryVersion:function(){if(!$||!$.fn||!$.fn.jquery){return false}var e=1,b=5,a=$.fn.jquery.split("."),d=parseInt(a[0]),c=parseInt(a[1]);return((d>=e)&&(c>=b))},getChannel:function(){var a="thermofisher.",d="fishersci.",c="tf",e="fs",b=Offers.location.hostname();if(b.indexOf(a)>0){return c}else{if(b.indexOf(d)>0){return e}}return""},processPagePath:function(b,a){a=a.replace(/&?debug_offers=true&?/g,"");a=a.replace(/\?$/g,"");return b+a},cleanSessionId:function(a){if(!a){return a}return a.replace("[CS]v1|","").replace("[CE]","")},location:{href:function(){return window.location.href},hostname:function(){return window.location.hostname},search:function(){return window.location.search},pathname:function(){return window.location.pathname},host:function(){return window.location.host},origin:function(){return window.location.origin}},replaceAllDotsWithArg:function(b,a){return b.replace(/\./g,a)}}}var Offers=OffersInit();Offers.start();